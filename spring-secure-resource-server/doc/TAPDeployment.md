# Tanzu Application Platform (TAP) Deployment

The Postal Codes TAP deployment options are enabled through a Tanzu application accelerator that will generate all necessary configuration for you.  

**NOTE** The postal codes solution is a wholly self contained accelerator intended to be used as learning sample for a secure resource server applications; it 
includes the generation and application of configuration files for multiple personas.  Although creation of all necessary configuration within a single
accelerator can facilitate the deployment of such a complex application for learning purposes, it is NOT indicative of how a typical application and ancillary 
service configuration would be created nor how the platform is intended to be used/configured in a real world scenario .  Instead, an application accelerator will normally 
create a starter project for the developer whilst the creation of other persona based configuration would be generated by and managed by other procedures 
resulting in a clean separation of concerns and to reduce platform implementation leakage.

## Quick Start

This section provides a fast track installation the postcal codes solution using the application accelerator and the instructions immediately below.  A more thorough description of the configuration 
and installation scenarios are describes in subsequent sections of this page.  This section assumes spring secure resource server application accelerator is already installed and that you have
already create DNS entries for your application domain.


* Navigate to your Tanzu Developer Portal web page and access the Application Accelerator module.  Select the `Choose` button on the `Spring Secure Resosurce Server` accelerator.
* Change the `workload-namespace` if need be to a namespace that you have already configured to run workloads (e.g. a developer namespace).  
* Populate the application domain name you wish to use.  The hosts `postal-code-search` and `postal-code-audit` will automatically be preappended to the domain name.
* Download and unzip the generate accelerator file to you workstation.
* Open a command shell and navigate to the root directory of the unzipped file from above.  Run the following commands to create all services, resources, and workloads:

**NOTE:**  If you did not configure the accelerator to automatically create a Git repo for your project, you will need to manually commit the project to a 
Git repo and update the `workload.yaml` file in the`./config/developer` directory with the appropriate Git repo URL and subPath locations for each workload.

```
kubectl apply -f ./config/ --recursive
```

Once the applications have been successfully built and deployed, you can access the UI applications at the following URLs:
* https://postal-code-search.`domain name`
* https://postal-code-audit.`domain name`

You can login with the following default accounts:

* Freemium Account: freemium/codes
* Premium Accont: premium/codes
* Security Officer: security/officer


## Application Accelerator Option


The accelerator generates configuration files for the various options that you select.  Configuration files will be placed in a `config` directory at the root of the generated file system 
and grouped together in sub directories by operational persona.  The personas include
* Service Operator: These configuration files are used to provision services such as Spring Cloud Gateway and AppSSO.
* Application Operator: These configuration files create service instances, application routes, ingress, and AppSSO application accounts.
* Developer: These configuration files contain the workload.yaml files for building and deploying the application components to the TAP cluster.

  
#### Accelerator Options
The accelerator contains the following configuration options:

* **Workload Namespace:** The namespace where the application micro-services will be deployed.  It is assumed that this namespace has already been created and has been configured to run TAP workloads.
* **Cluster Issuer Name:** The cluster issuer used for creating TLS certificates.  This defaults to the builting TAP cluster issuer.
* **Gateway Service Name:** The name of the Spring Cloud Gateway service that will be created.
* **Message Broker ServiceName:**  The name of the message borker resource that the micro-services will connect to.
* **Enable Rate Limiting:** If this box is checked, you can configure rate limiting to the search API.
* **Rate Limit:** If rate limiting is enabled, this is the maximum number requests allowed within a time window.
* **Rate Limit Time Window:** If rate limiting is enabled, this the length of the rate limit time window.
* **Rate Limit Time Window Units:** If rate limiting is enabled, this units of the rate limit time window.  Defaults to seconds.
* **AppSSO Instance Name:**  The name of the AppSSO resource that the micro-services will connect to. 
* **Application Domain:** The DNS domain name that will be used for the application UI and services.

**NOTE:** The default workload namespace is `workloads` and NOT `default`.  Make sure the workload namespace you choose is setup to build and run workloads.
